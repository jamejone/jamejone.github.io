<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>HTTP PUT is dead, long live HTTP PUT | So long, and thanks for all the bits</title> <meta name="generator" content="Jekyll v4.2.0"/> <meta property="og:title" content="HTTP PUT is dead, long live HTTP PUT"/> <meta name="author" content="James Jones"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Engineering client-server applications will always mean entertaining the possibility that clients will lag the server by at least one version."/> <meta property="og:description" content="Engineering client-server applications will always mean entertaining the possibility that clients will lag the server by at least one version."/> <link rel="canonical" href="https://jamejone.github.io/2020/02/27/put-is-dead/"/> <meta property="og:url" content="https://jamejone.github.io/2020/02/27/put-is-dead/"/> <meta property="og:site_name" content="So long, and thanks for all the bits"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2020-02-27T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="HTTP PUT is dead, long live HTTP PUT"/> <script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://jamejone.github.io/2020/02/27/put-is-dead/"},"description":"Engineering client-server applications will always mean entertaining the possibility that clients will lag the server by at least one version.","url":"https://jamejone.github.io/2020/02/27/put-is-dead/","@type":"BlogPosting","headline":"HTTP PUT is dead, long live HTTP PUT","dateModified":"2021-06-13T18:07:01+00:00","datePublished":"2020-02-27T00:00:00+00:00","author":{"@type":"Person","name":"James Jones"},"@context":"https://schema.org"}</script> <meta property=”og:image” content="https://jamejone.github.io/public/hey-nice-api.jpg"/> <meta name="theme-color" content="#313131"/> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png"> <link rel="shortcut icon" href="/public/favicon.ico"> <link rel="manifest" href="/manifest.json"> <link rel="alternate" type="application/atom+xml" title="So long, and thanks for all the bits" href="https://jamejone.github.io/feed"> <style type="text/css">*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif;font-size:16px;line-height:1.5}@media(min-width:38em){html{font-size:20px}}body{color:#ccc;background-color:#313131;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a:hover,a:focus{text-decoration:underline}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;font-size:85%;border:1px solid #515151;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #515151}th{text-align:left}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#313131}code,pre{font-family:Menlo,Monaco,"Courier New",monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;background-color:#313131;border-radius:3px}pre{margin-top:0;margin-bottom:1rem}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{padding:1rem;margin-bottom:1rem;font-size:.8rem;line-height:1.4;background-color:#313131;border-radius:.25rem}.highlight pre{margin-bottom:0;overflow-x:auto}.highlight .lineno{display:inline-block;padding-right:.75rem;padding-left:.25rem;color:#767676;-webkit-user-select:none;-moz-user-select:none;user-select:none}.container{max-width:38rem;padding-left:1.5rem;padding-right:1.5rem;margin-left:auto;margin-right:auto}footer{margin-bottom:2rem}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:2rem}.masthead-title{margin-top:0;margin-bottom:0;color:#ccc}.masthead-title a{color:inherit}.masthead-title small{font-size:75%;font-weight:400;opacity:.5}.message{margin-bottom:1rem;padding:1rem;color:#767676;background-color:#313131}.pagination{overflow:hidden;margin:0 -1.5rem 1rem;color:#515151;text-align:center}.pagination-item{display:block;padding:1rem;border:solid #515151;border-width:1px 0}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#313131}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%;border-width:1px}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}.page,.post{margin-bottom:4em}.page li+li,.post li+li{margin-top:.25rem}.page-title,.post-title,.post-title a{color:#f9f9f9}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#767676}.related{padding-top:2rem;padding-bottom:2rem;margin-bottom:2rem;border-top:1px solid #eee;border-bottom:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.highlight code,.highlight pre{color:#fdce93;background-color:#3f3f3f}.highlight .hll{background-color:#222}.highlight .err{color:#e37170;background-color:#3d3535}.highlight .k{color:#9eddfc}.highlight .p{color:#d4d4d4}.highlight .cs{color:#cd0000;font-weight:700}.highlight .gd{color:#cd0000}.highlight .ge{color:#ccc;font-style:italic}.highlight .gr{color:red}.highlight .go{color:gray}.highlight .gs{color:#ccc;font-weight:700}.highlight .gu{color:purple;font-weight:700}.highlight .gt{color:#0040d0}.highlight .kc{color:#dca3a3}.highlight .kd{color:#ffff86}.highlight .kn{color:#dfaf8f;font-weight:700}.highlight .kp{color:#cdcf99}.highlight .kr{color:#cdcd00}.highlight .ni{color:#c28182}.highlight .ne{color:#c3bf9f;font-weight:700}.highlight .nn{color:#8fbede}.highlight .vi{color:#ffffc7}.highlight .c,.highlight .g,.highlight .cm,.highlight .cp,.highlight .c1{color:#7f9f7f}.highlight .l,.highlight .x,.highlight .no,.highlight .nd,.highlight .nl,.highlight .nx,.highlight .py,.highlight .w{color:#ccc}.highlight .n,.highlight .nv,.highlight .vg{color:#d4d4d4}.highlight .o,.highlight .ow{color:#f0efd0}.highlight .gh,.highlight .gp{color:#dcdccc;font-weight:700}.highlight .gi,.highlight .kt{color:#9eddfc}.highlight .ld,.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .si,.highlight .sx,.highlight .sr,.highlight .s1,.highlight .ss{color:#cc9393}.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .il{color:#8cd0d3}.highlight .na,.highlight .nt{color:#9ac39f}.highlight .nb,.highlight .nc,.highlight .nf,.highlight .bp,.highlight .vc{color:#dcdbac}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:600;line-height:1.25;color:#f9f9f9;text-rendering:optimizeLegibility}
h1{font-size:2rem}h2{margin-top:1rem;font-size:1.5rem}h3{margin-top:1.5rem;font-size:1.25rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}dt{font-weight:bold}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:bold;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media(min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}a[href^="#fn:"],a[href^="#fnref:"]{display:inline-block;margin-left:.1rem;font-weight:bold}.footnotes{margin-top:2rem;font-size:85%}.lead{font-size:1.25rem;font-weight:300}</style> </head> <body> <div class="container content"> <header class="masthead"> <h3 class="masthead-title"> <a href="/" title="Home">So long, and thanks for all the bits</a> </h3> <h3 class="masthead-title"> <small>an engineering blog</small> </h3> <div style="margin: 3rem auto 0 auto; height: 92px;"> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7IT2JE&placement=blogcumulosoftwarecom" id="_carbonads_js"></script> <style type="text/css">#carbonads img{margin-bottom:0}#carbonads{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",Helvetica,Arial,sans-serif}#carbonads{display:block;overflow:hidden;max-width:700px;position:relative;border:solid 1px #444;box-sizing:content-box}#carbonads>span{display:block}#carbonads a{color:inherit;text-decoration:none}#carbonads a:hover{color:inherit}.carbon-wrap{display:flex;align-items:center}.carbon-img{display:block;margin:0;line-height:1}.carbon-img img{display:block;height:90px;width:auto}.carbon-text{display:block;padding:0 1em;line-height:1.35;text-align:left}.carbon-poweredby{display:block;position:absolute;bottom:0;right:0;padding:6px 10px;background:repeating-linear-gradient(-45deg,transparent,transparent 5px,hsla(0,0,0,.025) 5px,hsla(0,0,0,.025) 10px) hsla(203,11%,15%,.4);text-align:center;text-transform:uppercase;letter-spacing:.5px;font-weight:600;font-size:8px;border-top-left-radius:4px;line-height:1}@media only screen and (min-width:320px) and (max-width:759px){.carbon-text{font-size:14px}}</style> </div> </header> <main> <article class="post"> <h1 class="post-title">HTTP PUT is dead, long live HTTP PUT</h1> <span class="post-date"> <time datetime="2020-02-27T00:00:00+00:00">Feb 27, 2020</time> &middot; 2 min read </span> <picture><source srcset="/generated/public/hey-nice-api-400-94827fa99.webp 400w, /generated/public/hey-nice-api-600-94827fa99.webp 600w, /generated/public/hey-nice-api-800-94827fa99.webp 800w, /generated/public/hey-nice-api-1000-94827fa99.webp 1000w" type="image/webp"><source srcset="/generated/public/hey-nice-api-400-94827fa99.jpg 400w, /generated/public/hey-nice-api-600-94827fa99.jpg 600w, /generated/public/hey-nice-api-800-94827fa99.jpg 800w, /generated/public/hey-nice-api-1000-94827fa99.jpg 1000w" type="image/jpeg"><img src="/generated/public/hey-nice-api-800-94827fa99.jpg"></picture> <p>Absent some sort of alien quantum technology, engineering client-server applications will always mean entertaining the possibility that clients will lag the server by at least one version.</p> <p>Most people I know prefer to use the oldest version of software they can get away with. Updating software without a specific feature in mind means spending precious time learning a new interface and dealing with new bugs.</p> <p>As a system engineer, you can respond a couple different ways:</p> <ol> <li>If you’re ok with your users hating you, you can <a href="http://www.pushsquare.com/news/2019/12/ps4_firmware_update_7_02_is_ready_for_download_right_now">force client updates</a>.</li> <li>Plan for the possibility that some clients will lag the server by at least one version.</li> </ol> <h3 id="a-problematic-verb">A problematic verb</h3> <p>When it comes to RESTful API’s, the first HTTP verb that comes to mind when you’re editing a entity is almost always PUT. The problem with using PUT is that it lacks forward compatibility. Here’s why:</p> <p>Step 1: Client v1.1 POSTs a new entity to the server:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dave"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Step 2: An older client (v1.0) GETs the entity client v1.1 created, transforms it to a model compatible with its UI, lets the user modify it, and then attempts to send it back to the server via HTTP PUT. The thing is, the ‘age’ property was just added in v1.1 and client v1.0 has no notion of it, so the payload it sends looks like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Whitmer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Because we’re using PUT, the server must replace the entire document in the database with this new document, so “age” is dropped and this data is lost. If an older client is unknowingly deleting data created by newer clients, you’re gonna have a bad time.</p> <p>We can avoid having a bad time.</p> <h3 id="enter-json-merge-patch">Enter JSON Merge Patch</h3> <p>No, not <a href="https://tools.ietf.org/html/rfc6902">that other patch</a>. <a href="https://tools.ietf.org/html/rfc7386">JSON Merge Patch</a> is perfect because it’s almost exactly like PUT except it doesn’t delete fields it doesn’t know about.</p> <p>In other words, when you omit a property in a Merge PATCH, the database will simply let that property remain whatever value it presently is. This provides forward compatibility and thus fixes the main issue we have with PUT.</p> <h3 id="in-closing-stop-using-http-put">In closing, stop using HTTP PUT</h3> <p>It’s just bad, mkay? Okay fine it’s actually not that bad. PUT can actually be pretty great <a href="https://stackoverflow.com/questions/630453/put-vs-post-in-rest">for other things</a>, just consider PATCH instead when you’re trying to edit entities.</p> <h3>Thanks for reading. Feel free to leave a comment.</h3> <script src="https://utteranc.es/client.js" repo="jamejone/jamejone.github.io" issue-term="og:title" label="utterances" theme="photon-dark" crossorigin="anonymous" async> </script> </article> <aside class="related"> <h3>Related posts</h3> <ul class="related-posts"> <li> <a href="/2019/03/02/put-your-aspnet-core-controller-on-a-diet-with-middleware/"> Put your ASP.NET Core controller on a diet with middleware <small><time datetime="2019-03-02T00:00:00+00:00">02 Mar 2019</time></small> </a> </li> <li> <a href="/2019/11/14/temporal-repository-implementation-using-mongodb-and-aspnet-core/"> Temporal repository implementation using MongoDB and ASP.NET Core <small><time datetime="2019-11-14T00:00:00+00:00">14 Nov 2019</time></small> </a> </li> <li> <a href="/2019/01/22/real-time-by-accident/"> Real-time by accident <small><time datetime="2019-01-22T00:00:00+00:00">22 Jan 2019</time></small> </a> </li> </ul> </aside> </main> <footer class="footer"> <small> &copy; <time datetime="2021-06-13T18:09:43+00:00">2021</time>. All rights reserved. </small> </footer> </div> <script async src="https://www.googletagmanager.com/gtag/js?id=G-MYYT4724GY"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MYYT4724GY");</script> </body> </html>